{"ast":null,"code":"var ASYMMETRIC_KEY_DETAILS_SUPPORTED = require('./asymmetricKeyDetailsSupported');\nvar RSA_PSS_KEY_DETAILS_SUPPORTED = require('./rsaPssKeyDetailsSupported');\nvar allowedAlgorithmsForKeys = {\n  'ec': ['ES256', 'ES384', 'ES512'],\n  'rsa': ['RS256', 'PS256', 'RS384', 'PS384', 'RS512', 'PS512'],\n  'rsa-pss': ['PS256', 'PS384', 'PS512']\n};\nvar allowedCurves = {\n  ES256: 'prime256v1',\n  ES384: 'secp384r1',\n  ES512: 'secp521r1'\n};\nmodule.exports = function (algorithm, key) {\n  if (!algorithm || !key) return;\n  var keyType = key.asymmetricKeyType;\n  if (!keyType) return;\n  var allowedAlgorithms = allowedAlgorithmsForKeys[keyType];\n  if (!allowedAlgorithms) {\n    throw new Error(\"Unknown key type \\\"\".concat(keyType, \"\\\".\"));\n  }\n  if (!allowedAlgorithms.includes(algorithm)) {\n    throw new Error(\"\\\"alg\\\" parameter for \\\"\".concat(keyType, \"\\\" key type must be one of: \").concat(allowedAlgorithms.join(', '), \".\"));\n  }\n\n  /*\n   * Ignore the next block from test coverage because it gets executed\n   * conditionally depending on the Node version. Not ignoring it would\n   * prevent us from reaching the target % of coverage for versions of\n   * Node under 15.7.0.\n   */\n  /* istanbul ignore next */\n  if (ASYMMETRIC_KEY_DETAILS_SUPPORTED) {\n    switch (keyType) {\n      case 'ec':\n        var keyCurve = key.asymmetricKeyDetails.namedCurve;\n        var allowedCurve = allowedCurves[algorithm];\n        if (keyCurve !== allowedCurve) {\n          throw new Error(\"\\\"alg\\\" parameter \\\"\".concat(algorithm, \"\\\" requires curve \\\"\").concat(allowedCurve, \"\\\".\"));\n        }\n        break;\n      case 'rsa-pss':\n        if (RSA_PSS_KEY_DETAILS_SUPPORTED) {\n          var length = parseInt(algorithm.slice(-3), 10);\n          var _key$asymmetricKeyDet = key.asymmetricKeyDetails,\n            hashAlgorithm = _key$asymmetricKeyDet.hashAlgorithm,\n            mgf1HashAlgorithm = _key$asymmetricKeyDet.mgf1HashAlgorithm,\n            saltLength = _key$asymmetricKeyDet.saltLength;\n          if (hashAlgorithm !== \"sha\".concat(length) || mgf1HashAlgorithm !== hashAlgorithm) {\n            throw new Error(\"Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of \\\"alg\\\" \".concat(algorithm, \".\"));\n          }\n          if (saltLength !== undefined && saltLength > length >> 3) {\n            throw new Error(\"Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of \\\"alg\\\" \".concat(algorithm, \".\"));\n          }\n        }\n        break;\n    }\n  }\n};","map":null,"metadata":{},"sourceType":"script"}